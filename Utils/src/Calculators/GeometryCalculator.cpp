#include <Utils/Calculators/GeometryCalculator.hpp>
#include <Utils/Calculators/RangeCalculator.hpp>
#include <cmath>

const std::vector<Vector2f> GeometryCalculator::degreesToNormalizedVector = std::vector<Vector2f>{
	Vector2f(0.f, 1.f),
	Vector2f(0.0174524f, 0.999848f),
	Vector2f(0.0348995f, 0.999391f),
	Vector2f(0.052336f, 0.99863f),
	Vector2f(0.0697565f, 0.997564f),
	Vector2f(0.0871557f, 0.996195f),
	Vector2f(0.104528f, 0.994522f),
	Vector2f(0.121869f, 0.992546f),
	Vector2f(0.139173f, 0.990268f),
	Vector2f(0.156434f, 0.987688f),
	Vector2f(0.173648f, 0.984808f),
	Vector2f(0.190809f, 0.981627f),
	Vector2f(0.207912f, 0.978148f),
	Vector2f(0.224951f, 0.97437f),
	Vector2f(0.241922f, 0.970296f),
	Vector2f(0.258819f, 0.965926f),
	Vector2f(0.275637f, 0.961262f),
	Vector2f(0.292372f, 0.956305f),
	Vector2f(0.309017f, 0.951057f),
	Vector2f(0.325568f, 0.945519f),
	Vector2f(0.34202f, 0.939693f),
	Vector2f(0.358368f, 0.93358f),
	Vector2f(0.374607f, 0.927184f),
	Vector2f(0.390731f, 0.920505f),
	Vector2f(0.406737f, 0.913545f),
	Vector2f(0.422618f, 0.906308f),
	Vector2f(0.438371f, 0.898794f),
	Vector2f(0.45399f, 0.891007f),
	Vector2f(0.469472f, 0.882948f),
	Vector2f(0.48481f, 0.87462f),
	Vector2f(0.5f, 0.866025f),
	Vector2f(0.515038f, 0.857167f),
	Vector2f(0.529919f, 0.848048f),
	Vector2f(0.544639f, 0.838671f),
	Vector2f(0.559193f, 0.829038f),
	Vector2f(0.573576f, 0.819152f),
	Vector2f(0.587785f, 0.809017f),
	Vector2f(0.601815f, 0.798636f),
	Vector2f(0.615661f, 0.788011f),
	Vector2f(0.62932f, 0.777146f),
	Vector2f(0.642788f, 0.766044f),
	Vector2f(0.656059f, 0.75471f),
	Vector2f(0.669131f, 0.743145f),
	Vector2f(0.681998f, 0.731354f),
	Vector2f(0.694658f, 0.71934f),
	Vector2f(0.707107f, 0.707107f),
	Vector2f(0.71934f, 0.694658f),
	Vector2f(0.731354f, 0.681998f),
	Vector2f(0.743145f, 0.669131f),
	Vector2f(0.75471f, 0.656059f),
	Vector2f(0.766044f, 0.642788f),
	Vector2f(0.777146f, 0.62932f),
	Vector2f(0.788011f, 0.615661f),
	Vector2f(0.798636f, 0.601815f),
	Vector2f(0.809017f, 0.587785f),
	Vector2f(0.819152f, 0.573576f),
	Vector2f(0.829038f, 0.559193f),
	Vector2f(0.838671f, 0.544639f),
	Vector2f(0.848048f, 0.529919f),
	Vector2f(0.857167f, 0.515038f),
	Vector2f(0.866025f, 0.5f),
	Vector2f(0.87462f, 0.48481f),
	Vector2f(0.882948f, 0.469472f),
	Vector2f(0.891007f, 0.45399f),
	Vector2f(0.898794f, 0.438371f),
	Vector2f(0.906308f, 0.422618f),
	Vector2f(0.913545f, 0.406737f),
	Vector2f(0.920505f, 0.390731f),
	Vector2f(0.927184f, 0.374607f),
	Vector2f(0.93358f, 0.358368f),
	Vector2f(0.939693f, 0.34202f),
	Vector2f(0.945519f, 0.325568f),
	Vector2f(0.951057f, 0.309017f),
	Vector2f(0.956305f, 0.292372f),
	Vector2f(0.961262f, 0.275637f),
	Vector2f(0.965926f, 0.258819f),
	Vector2f(0.970296f, 0.241922f),
	Vector2f(0.97437f, 0.224951f),
	Vector2f(0.978148f, 0.207912f),
	Vector2f(0.981627f, 0.190809f),
	Vector2f(0.984808f, 0.173648f),
	Vector2f(0.987688f, 0.156434f),
	Vector2f(0.990268f, 0.139173f),
	Vector2f(0.992546f, 0.121869f),
	Vector2f(0.994522f, 0.104528f),
	Vector2f(0.996195f, 0.0871557f),
	Vector2f(0.997564f, 0.0697565f),
	Vector2f(0.99863f, 0.052336f),
	Vector2f(0.999391f, 0.0348995f),
	Vector2f(0.999848f, 0.0174524f),
	Vector2f(1.f, 0.f),
	Vector2f(0.999848f, -0.0174524f),
	Vector2f(0.999391f, -0.0348995f),
	Vector2f(0.99863f, -0.052336f),
	Vector2f(0.997564f, -0.0697565f),
	Vector2f(0.996195f, -0.0871557f),
	Vector2f(0.994522f, -0.104528f),
	Vector2f(0.992546f, -0.121869f),
	Vector2f(0.990268f, -0.139173f),
	Vector2f(0.987688f, -0.156434f),
	Vector2f(0.984808f, -0.173648f),
	Vector2f(0.981627f, -0.190809f),
	Vector2f(0.978148f, -0.207912f),
	Vector2f(0.97437f, -0.224951f),
	Vector2f(0.970296f, -0.241922f),
	Vector2f(0.965926f, -0.258819f),
	Vector2f(0.961262f, -0.275637f),
	Vector2f(0.956305f, -0.292372f),
	Vector2f(0.951057f, -0.309017f),
	Vector2f(0.945519f, -0.325568f),
	Vector2f(0.939693f, -0.34202f),
	Vector2f(0.93358f, -0.358368f),
	Vector2f(0.927184f, -0.374607f),
	Vector2f(0.920505f, -0.390731f),
	Vector2f(0.913545f, -0.406737f),
	Vector2f(0.906308f, -0.422618f),
	Vector2f(0.898794f, -0.438371f),
	Vector2f(0.891007f, -0.45399f),
	Vector2f(0.882948f, -0.469472f),
	Vector2f(0.87462f, -0.48481f),
	Vector2f(0.866025f, -0.5f),
	Vector2f(0.857167f, -0.515038f),
	Vector2f(0.848048f, -0.529919f),
	Vector2f(0.838671f, -0.544639f),
	Vector2f(0.829038f, -0.559193f),
	Vector2f(0.819152f, -0.573576f),
	Vector2f(0.809017f, -0.587785f),
	Vector2f(0.798636f, -0.601815f),
	Vector2f(0.788011f, -0.615661f),
	Vector2f(0.777146f, -0.62932f),
	Vector2f(0.766044f, -0.642788f),
	Vector2f(0.75471f, -0.656059f),
	Vector2f(0.743145f, -0.669131f),
	Vector2f(0.731354f, -0.681998f),
	Vector2f(0.71934f, -0.694658f),
	Vector2f(0.707107f, -0.707107f),
	Vector2f(0.694658f, -0.71934f),
	Vector2f(0.681998f, -0.731354f),
	Vector2f(0.669131f, -0.743145f),
	Vector2f(0.656059f, -0.75471f),
	Vector2f(0.642788f, -0.766044f),
	Vector2f(0.62932f, -0.777146f),
	Vector2f(0.615661f, -0.788011f),
	Vector2f(0.601815f, -0.798636f),
	Vector2f(0.587785f, -0.809017f),
	Vector2f(0.573576f, -0.819152f),
	Vector2f(0.559193f, -0.829038f),
	Vector2f(0.544639f, -0.838671f),
	Vector2f(0.529919f, -0.848048f),
	Vector2f(0.515038f, -0.857167f),
	Vector2f(0.5f, -0.866025f),
	Vector2f(0.48481f, -0.87462f),
	Vector2f(0.469472f, -0.882948f),
	Vector2f(0.45399f, -0.891007f),
	Vector2f(0.438371f, -0.898794f),
	Vector2f(0.422618f, -0.906308f),
	Vector2f(0.406737f, -0.913545f),
	Vector2f(0.390731f, -0.920505f),
	Vector2f(0.374607f, -0.927184f),
	Vector2f(0.358368f, -0.93358f),
	Vector2f(0.34202f, -0.939693f),
	Vector2f(0.325568f, -0.945519f),
	Vector2f(0.309017f, -0.951057f),
	Vector2f(0.292372f, -0.956305f),
	Vector2f(0.275637f, -0.961262f),
	Vector2f(0.258819f, -0.965926f),
	Vector2f(0.241922f, -0.970296f),
	Vector2f(0.224951f, -0.97437f),
	Vector2f(0.207912f, -0.978148f),
	Vector2f(0.190809f, -0.981627f),
	Vector2f(0.173648f, -0.984808f),
	Vector2f(0.156434f, -0.987688f),
	Vector2f(0.139173f, -0.990268f),
	Vector2f(0.121869f, -0.992546f),
	Vector2f(0.104528f, -0.994522f),
	Vector2f(0.0871557f, -0.996195f),
	Vector2f(0.0697565f, -0.997564f),
	Vector2f(0.052336f, -0.99863f),
	Vector2f(0.0348995f, -0.999391f),
	Vector2f(0.0174524f, -0.999848f),
	Vector2f(0.f, -1.f),
	Vector2f(-0.0174524f, -0.999848f),
	Vector2f(-0.0348995f, -0.999391f),
	Vector2f(-0.052336f, -0.99863f),
	Vector2f(-0.0697565f, -0.997564f),
	Vector2f(-0.0871557f, -0.996195f),
	Vector2f(-0.104528f, -0.994522f),
	Vector2f(-0.121869f, -0.992546f),
	Vector2f(-0.139173f, -0.990268f),
	Vector2f(-0.156434f, -0.987688f),
	Vector2f(-0.173648f, -0.984808f),
	Vector2f(-0.190809f, -0.981627f),
	Vector2f(-0.207912f, -0.978148f),
	Vector2f(-0.224951f, -0.97437f),
	Vector2f(-0.241922f, -0.970296f),
	Vector2f(-0.258819f, -0.965926f),
	Vector2f(-0.275637f, -0.961262f),
	Vector2f(-0.292372f, -0.956305f),
	Vector2f(-0.309017f, -0.951057f),
	Vector2f(-0.325568f, -0.945519f),
	Vector2f(-0.34202f, -0.939693f),
	Vector2f(-0.358368f, -0.93358f),
	Vector2f(-0.374607f, -0.927184f),
	Vector2f(-0.390731f, -0.920505f),
	Vector2f(-0.406737f, -0.913545f),
	Vector2f(-0.422618f, -0.906308f),
	Vector2f(-0.438371f, -0.898794f),
	Vector2f(-0.45399f, -0.891007f),
	Vector2f(-0.469472f, -0.882948f),
	Vector2f(-0.48481f, -0.87462f),
	Vector2f(-0.5f, -0.866025f),
	Vector2f(-0.515038f, -0.857167f),
	Vector2f(-0.529919f, -0.848048f),
	Vector2f(-0.544639f, -0.838671f),
	Vector2f(-0.559193f, -0.829038f),
	Vector2f(-0.573576f, -0.819152f),
	Vector2f(-0.587785f, -0.809017f),
	Vector2f(-0.601815f, -0.798636f),
	Vector2f(-0.615661f, -0.788011f),
	Vector2f(-0.62932f, -0.777146f),
	Vector2f(-0.642788f, -0.766044f),
	Vector2f(-0.656059f, -0.75471f),
	Vector2f(-0.669131f, -0.743145f),
	Vector2f(-0.681998f, -0.731354f),
	Vector2f(-0.694658f, -0.71934f),
	Vector2f(-0.707107f, -0.707107f),
	Vector2f(-0.71934f, -0.694658f),
	Vector2f(-0.731354f, -0.681998f),
	Vector2f(-0.743145f, -0.669131f),
	Vector2f(-0.75471f, -0.656059f),
	Vector2f(-0.766044f, -0.642788f),
	Vector2f(-0.777146f, -0.62932f),
	Vector2f(-0.788011f, -0.615661f),
	Vector2f(-0.798636f, -0.601815f),
	Vector2f(-0.809017f, -0.587785f),
	Vector2f(-0.819152f, -0.573576f),
	Vector2f(-0.829038f, -0.559193f),
	Vector2f(-0.838671f, -0.544639f),
	Vector2f(-0.848048f, -0.529919f),
	Vector2f(-0.857167f, -0.515038f),
	Vector2f(-0.866025f, -0.5f),
	Vector2f(-0.87462f, -0.48481f),
	Vector2f(-0.882948f, -0.469472f),
	Vector2f(-0.891007f, -0.45399f),
	Vector2f(-0.898794f, -0.438371f),
	Vector2f(-0.906308f, -0.422618f),
	Vector2f(-0.913545f, -0.406737f),
	Vector2f(-0.920505f, -0.390731f),
	Vector2f(-0.927184f, -0.374607f),
	Vector2f(-0.93358f, -0.358368f),
	Vector2f(-0.939693f, -0.34202f),
	Vector2f(-0.945519f, -0.325568f),
	Vector2f(-0.951057f, -0.309017f),
	Vector2f(-0.956305f, -0.292372f),
	Vector2f(-0.961262f, -0.275637f),
	Vector2f(-0.965926f, -0.258819f),
	Vector2f(-0.970296f, -0.241922f),
	Vector2f(-0.97437f, -0.224951f),
	Vector2f(-0.978148f, -0.207912f),
	Vector2f(-0.981627f, -0.190809f),
	Vector2f(-0.984808f, -0.173648f),
	Vector2f(-0.987688f, -0.156434f),
	Vector2f(-0.990268f, -0.139173f),
	Vector2f(-0.992546f, -0.121869f),
	Vector2f(-0.994522f, -0.104528f),
	Vector2f(-0.996195f, -0.0871557f),
	Vector2f(-0.997564f, -0.0697565f),
	Vector2f(-0.99863f, -0.052336f),
	Vector2f(-0.999391f, -0.0348995f),
	Vector2f(-0.999848f, -0.0174524f),
	Vector2f(-1.f, 0.f),
	Vector2f(-0.999848f, 0.0174524f),
	Vector2f(-0.999391f, 0.0348995f),
	Vector2f(-0.99863f, 0.052336f),
	Vector2f(-0.997564f, 0.0697565f),
	Vector2f(-0.996195f, 0.0871557f),
	Vector2f(-0.994522f, 0.104528f),
	Vector2f(-0.992546f, 0.121869f),
	Vector2f(-0.990268f, 0.139173f),
	Vector2f(-0.987688f, 0.156434f),
	Vector2f(-0.984808f, 0.173648f),
	Vector2f(-0.981627f, 0.190809f),
	Vector2f(-0.978148f, 0.207912f),
	Vector2f(-0.97437f, 0.224951f),
	Vector2f(-0.970296f, 0.241922f),
	Vector2f(-0.965926f, 0.258819f),
	Vector2f(-0.961262f, 0.275637f),
	Vector2f(-0.956305f, 0.292372f),
	Vector2f(-0.951057f, 0.309017f),
	Vector2f(-0.945519f, 0.325568f),
	Vector2f(-0.939693f, 0.34202f),
	Vector2f(-0.93358f, 0.358368f),
	Vector2f(-0.927184f, 0.374607f),
	Vector2f(-0.920505f, 0.390731f),
	Vector2f(-0.913545f, 0.406737f),
	Vector2f(-0.906308f, 0.422618f),
	Vector2f(-0.898794f, 0.438371f),
	Vector2f(-0.891007f, 0.45399f),
	Vector2f(-0.882948f, 0.469472f),
	Vector2f(-0.87462f, 0.48481f),
	Vector2f(-0.866025f, 0.5f),
	Vector2f(-0.857167f, 0.515038f),
	Vector2f(-0.848048f, 0.529919f),
	Vector2f(-0.838671f, 0.544639f),
	Vector2f(-0.829038f, 0.559193f),
	Vector2f(-0.819152f, 0.573576f),
	Vector2f(-0.809017f, 0.587785f),
	Vector2f(-0.798636f, 0.601815f),
	Vector2f(-0.788011f, 0.615661f),
	Vector2f(-0.777146f, 0.62932f),
	Vector2f(-0.766044f, 0.642788f),
	Vector2f(-0.75471f, 0.656059f),
	Vector2f(-0.743145f, 0.669131f),
	Vector2f(-0.731354f, 0.681998f),
	Vector2f(-0.71934f, 0.694658f),
	Vector2f(-0.707107f, 0.707107f),
	Vector2f(-0.694658f, 0.71934f),
	Vector2f(-0.681998f, 0.731354f),
	Vector2f(-0.669131f, 0.743145f),
	Vector2f(-0.656059f, 0.75471f),
	Vector2f(-0.642788f, 0.766044f),
	Vector2f(-0.62932f, 0.777146f),
	Vector2f(-0.615661f, 0.788011f),
	Vector2f(-0.601815f, 0.798636f),
	Vector2f(-0.587785f, 0.809017f),
	Vector2f(-0.573576f, 0.819152f),
	Vector2f(-0.559193f, 0.829038f),
	Vector2f(-0.544639f, 0.838671f),
	Vector2f(-0.529919f, 0.848048f),
	Vector2f(-0.515038f, 0.857167f),
	Vector2f(-0.5f, 0.866025f),
	Vector2f(-0.48481f, 0.87462f),
	Vector2f(-0.469472f, 0.882948f),
	Vector2f(-0.45399f, 0.891007f),
	Vector2f(-0.438371f, 0.898794f),
	Vector2f(-0.422618f, 0.906308f),
	Vector2f(-0.406737f, 0.913545f),
	Vector2f(-0.390731f, 0.920505f),
	Vector2f(-0.374607f, 0.927184f),
	Vector2f(-0.358368f, 0.93358f),
	Vector2f(-0.34202f, 0.939693f),
	Vector2f(-0.325568f, 0.945519f),
	Vector2f(-0.309017f, 0.951057f),
	Vector2f(-0.292372f, 0.956305f),
	Vector2f(-0.275637f, 0.961262f),
	Vector2f(-0.258819f, 0.965926f),
	Vector2f(-0.241922f, 0.970296f),
	Vector2f(-0.224951f, 0.97437f),
	Vector2f(-0.207912f, 0.978148f),
	Vector2f(-0.190809f, 0.981627f),
	Vector2f(-0.173648f, 0.984808f),
	Vector2f(-0.156434f, 0.987688f),
	Vector2f(-0.139173f, 0.990268f),
	Vector2f(-0.121869f, 0.992546f),
	Vector2f(-0.104528f, 0.994522f),
	Vector2f(-0.0871557f, 0.996195f),
	Vector2f(-0.0697565f, 0.997564f),
	Vector2f(-0.052336f, 0.99863f),
	Vector2f(-0.0348995f, 0.999391f),
	Vector2f(-0.0174524f, 0.999848f),
	Vector2f(-2.44929e-16f, 1.f)
};


int GeometryCalculator::getManhattanDistance(const Vector2i& firstVector, const Vector2i& secondVector)
{
	return std::abs(firstVector.x - secondVector.x) + std::abs(firstVector.y - secondVector.y);
}

int GeometryCalculator::degreesToBase360(int degrees)
{
	return (degrees >= 0 ? degrees : degrees - (degrees / 360 - 1) * 360) % 360;
}

Vector2f GeometryCalculator::angleToNormalizedVector(int degrees)
{
	int flattenedDegrees = degreesToBase360(degrees);
	return degreesToNormalizedVector[flattenedDegrees];
}

Vector2f GeometryCalculator::normalizeVector(const Vector2f & vector)
{
	float norm = getNormOfVector(vector);
	return Vector2f(vector.x / norm, vector.y / norm);
}

float GeometryCalculator::getNormOfVector(const Vector2f & vector)
{
	return std::sqrtf(vector.x * vector.x + vector.y * vector.y);
}

std::vector<Vector2i> GeometryCalculator::getDirectionsToEveryAdjacentTileClockwise(int startingRotationInDegrees)
{
	startingRotationInDegrees = (startingRotationInDegrees / 45) * 45;
	auto result = std::vector<Vector2i>();
	result.reserve(8);
	for (int i = 0; i < 8; i++)
		result.push_back(getDirectionToAdjacentTile(startingRotationInDegrees + 45 * i));
	return result;
}

Vector2i GeometryCalculator::getDirectionToAdjacentTile(int rotationInDegrees)
{
	auto normalizedVector = angleToNormalizedVector(rotationInDegrees) * 1.42f;
	return Vector2i((int) normalizedVector.x, (int)normalizedVector.y);
}
